From 09edddddb8a044a6a1788d461838188c1af22647 Mon Sep 17 00:00:00 2001
From: fujiwara <shintaro.fujiwara@gmail.com>
Date: Wed, 26 Aug 2020 06:05:05 +0900
Subject: [PATCH] fix for PostgreSQL.

---
 classes/pdf_core.php | 5 +++--
 version.php          | 4 ++--
 2 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/classes/pdf_core.php b/classes/pdf_core.php
index 630e368..73bdc6e 100644
--- a/classes/pdf_core.php
+++ b/classes/pdf_core.php
@@ -43,7 +43,7 @@ class tool_managecourse_pdf {
 
         $VIEW_COLUMNS="m.id as user_enrolments_id, k.name AS categoryname, u.id AS userid, u.firstname,
                        u.lastname, e.id enrolid, r.shortname AS rolename, c.fullname,
-		       FROM_UNIXTIME(c.startdate, '%Y/%m/%d') AS startdate, FROM_UNIXTIME(c.enddate, '%Y/%m/%d') AS enddate,
+		       to_timestamp(c.startdate) AS startdate, to_timestamp(c.enddate) AS enddate,
                        g.finalgrade, g.rawgrademax";
         $FROM_TABLES="FROM {user} u, {user_enrolments} m, {enrol} e, {course} c, {role_assignments} a,
                       {role} r , {grade_items} i, {grade_grades} g, {course_categories} k";
@@ -70,7 +70,8 @@ class tool_managecourse_pdf {
         if ($courseid) {
             $CONDITION3 = "AND c.id = $courseid";
         }
-        $GROUP_BY="GROUP BY m.id,u.id";
+        $GROUP_BY ="GROUP BY m.id,u.id, e.id, c.id, k.name, r.shortname, c.fullname,
+                    c.startdate, c.enddate, g.finalgrade, g.rawgrademax";
         $ORDER="ORDER BY u.id, c.startdate, m.id, e.id, c.id";
         $DESC="DESC";
         $ASC="ASC";
diff --git a/version.php b/version.php
index 19ebe6a..600d46c 100644
--- a/version.php
+++ b/version.php
@@ -25,7 +25,7 @@
 defined('MOODLE_INTERNAL') || die();
 
 $plugin->component = 'tool_managecourse';
-$plugin->release = '0.1.47';
-$plugin->version = 2020082628;
+$plugin->release = '0.1.48';
+$plugin->version = 2020082629;
 $plugin->requires = 2018051700;
 $plugin->maturity = MATURITY_ALPHA;
-- 
2.26.2

